<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="SignIn.Maui.ProjectsView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:controls="clr-namespace:SignIn.Maui.UserControls"
    xmlns:converters="clr-namespace:SignIn.Maui.Converters"
    xmlns:ios="clr-namespace:Microsoft.Maui.Controls.PlatformConfiguration.iOSSpecific;assembly=Microsoft.Maui.Controls"
    xmlns:models="clr-namespace:SignIn.Maui.Models"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:viewmodels="clr-namespace:SignIn.Maui.ViewModels"
    x:Name="ProjectListView"
    x:DataType="viewmodels:ProjectsListViewModel">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:BytesToImageConverter x:Key="ToImage" />
            <toolkit:InvertedBoolConverter x:Key="InvertedBoolConverter" />
            <converters:UpperCaseConverter x:Key="UppercaseConverter " />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="55,100,*,100">
        <controls:ToolBar
            Grid.Row="0"
            SignoutButtonVisibility="True"
            TabBarVisibility="True" />
        <Frame
            Grid.Row="1"
            CornerRadius="0.1"
            WidthRequest="620" HorizontalOptions="Start">
            <Grid
                Margin="10,0,0,0">

                <StackLayout

                    Margin="5,0,0,0"
                    IsEnabled="{Binding AreProjectsLoading, Converter={StaticResource InvertedBoolConverter}}"
                    VerticalOptions="Center"
                    Orientation="Horizontal">
                    <Button
                        BackgroundColor="Black"
                        BorderWidth="0"
                        Command="{Binding DoSelectRegionCommand, Source={x:Reference ProjectListView}}"
                        FontSize="15"
                        HeightRequest="24"
                        HorizontalOptions="Start"
                        Text="{Binding SelectedRegionName, Converter={StaticResource UppercaseConverter}}"
                        VerticalOptions="Center">
			<VisualStateManager.VisualStateGroups>
                            <VisualStateGroupList>
                                <VisualStateGroup x:Name="CommonStates">
                                    <VisualState x:Name="Normal" />
                                    <VisualState x:Name="Disabled">
                                        <VisualState.Setters>
                                            <Setter Property="BackgroundColor" Value="Transparent" />
                                            <Setter Property="TextColor" Value="{StaticResource BrushLightGray}" />
                                        </VisualState.Setters>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateGroupList>
                        </VisualStateManager.VisualStateGroups>
                    </Button>

                    <RadioButton
                        x:Name="RegionButtonImage"
                        HeightRequest="25"
                        HorizontalOptions="Start"
                        Style="{StaticResource PreferenceButtonStyle}"
                        WidthRequest="25">
                        <RadioButton.Content>
                            <Image
                                Background="Transparent"
                                HeightRequest="25"
                                HorizontalOptions="End"
                                Source="downarrow_black.png"
                                VerticalOptions="Center"
                                WidthRequest="25" />
                        </RadioButton.Content>
                        <RadioButton.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding DoSelectRegionCommand, Source={x:Reference ProjectListView}}" />
                        </RadioButton.GestureRecognizers>
                    </RadioButton>
                </StackLayout>
            </Grid>
        </Frame>

        <!--  Loader Image  -->

        <Grid
            Grid.Row="2"
            Background="Transparent"
            HorizontalOptions="Center"
            VerticalOptions="Center">
            <ActivityIndicator IsRunning="True" IsVisible="{Binding AreProjectsLoading}" />
        </Grid>

        <CollectionView
            x:Name="projectsListView"
            Grid.Row="2"
            Margin="10"
            HorizontalOptions="Center"
            IsVisible="{Binding AreProjectsLoading, Converter={StaticResource InvertedBoolConverter}}"
            ItemsSource="{Binding FilteredProjects}"
            SelectionMode="None"
            VerticalOptions="Start"
            VerticalScrollBarVisibility="Default"
            WidthRequest="600">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:ProjectMetaData">
                    <Grid
                        ColumnDefinitions="130, *, 20"
                        HorizontalOptions="Center"
                        RowDefinitions="Auto,Auto"
                        RowSpacing="10">
                        <Border Stroke="Transparent">
                            <Image
                                Grid.Column="0"
                                HeightRequest="75"
                                Source="{Binding ThumbnailSource, Converter={StaticResource ToImage}}"
                                WidthRequest="135" />
                        </Border>
                        <Label
                            Grid.Column="1"
                            Margin="10,0,0,0"
                            FontAttributes="Bold"
                            FontFamily="Open Sans"
                            FontSize="14"
                            HorizontalOptions="Start"
                            LineBreakMode="TailTruncation"
                            Text="{Binding Name}"
                            TextColor="Black"
                            VerticalTextAlignment="Center"
                            WidthRequest="400" />
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
        <Frame Grid.Row="3" CornerRadius="0.1">
            <Grid Margin="10" ColumnDefinitions="470,*">
                <Label
                    Grid.Column="0"
                    FontFamily="Open Sans"
                    FontSize="13"
                    HeightRequest="24"
                    HorizontalOptions="Start"
                    Text="{Binding LastRefreshedTime}"
                    TextColor="Black"
                    VerticalTextAlignment="Start"
                    WidthRequest="250" />
                <Button
                    Grid.Column="1"
                    BackgroundColor="Transparent"
                    BorderWidth="0"
                    Command="{Binding DoRefreshProjectsCommand}"
                    ContentLayout="Right,10"
                    FontSize="13"
                    HeightRequest="24"
                    HorizontalOptions="End"
                    ImageSource="refresh_icon.png"
                    IsVisible="{Binding AreProjectsLoading, Converter={StaticResource InvertedBoolConverter}}"
                    Text="Refresh now"
                    TextColor="Black"
                    VerticalOptions="Center"
                    WidthRequest="200" />

            </Grid>
        </Frame>
    </Grid>
</ContentPage>