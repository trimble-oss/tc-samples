<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="TCBrowser.Maui.LoginView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:controls="clr-namespace:TCBrowser.Maui.UserControls"
    xmlns:viewmodel="clr-namespace:TCBrowser.Maui.ViewModels"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    x:DataType="viewmodel:LoginViewModel">

    <ContentPage.Resources>
        <ResourceDictionary>
            <toolkit:InvertedBoolConverter x:Key="InvertedBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid>
        <Grid.RowDefinitions>
           <RowDefinition Height="55"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Image
            x:Name="backgroundImage"
            Grid.RowSpan="2"
            Aspect="AspectFit"
            HorizontalOptions="EndAndExpand"
            Source="tid.png"
            VerticalOptions="StartAndExpand" />

        <Border
            Grid.Row="1"
            Padding="16,8"
            HeightRequest="350"
            HorizontalOptions="Center"
            Stroke="LightGray"
            StrokeThickness="2"
            WidthRequest="400"
            IsVisible="{Binding IsLoading}">
            <Grid RowDefinitions="100,*">
                <Label Grid.Row="0" HorizontalOptions="Center" VerticalOptions="Center"
                       FontSize="20"
                       SemanticProperties.HeadingLevel="Level2"
                       Text="Signing in..." 
                       IsVisible="{Binding IsLogOutPage, Converter={StaticResource InvertedBoolConverter}}"/>

                <Label Grid.Row="0" HorizontalOptions="Center" VerticalOptions="Center"
                       FontSize="20"
                       Text="Signing out..."
                       IsVisible="{Binding IsLogOutPage}"/>

                 <ActivityIndicator Grid.Row="1" IsVisible="True" IsRunning="True"/>
            </Grid>
            
        </Border>

        <Border
            Grid.Row="1"
            Padding="16,8"
            HeightRequest="350"
            HorizontalOptions="Center"
            Stroke="LightGray"
            StrokeThickness="2"
            WidthRequest="400"
            IsVisible="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}">
            
            <Grid VerticalOptions="Center"
                  RowDefinitions="50,*,90">
                
                <Label Grid.Row="0"
                    FontSize="26"
                    HorizontalOptions="Center"
                    SemanticProperties.HeadingLevel="Level1"
                    Text="Welcome!"
                    IsVisible="{Binding ShowLongDescription, Converter={StaticResource InvertedBoolConverter}}"/>                

                <Label
                    Grid.Row="1"
                    FontSize="22"
                    HorizontalOptions="Center"
                    SemanticProperties.HeadingLevel="Level2"
                    Text="Sign in to start using the tool"
                    WidthRequest="300"
                    IsVisible="{Binding ShowLongDescription, Converter={StaticResource InvertedBoolConverter}}"/>

                <Label Grid.Row="0" HorizontalOptions="Center" VerticalOptions="Center"
                       FontSize="20"
                       SemanticProperties.HeadingLevel="Level2"
                       Text="Signing in..." 
                       IsVisible="{Binding ShowLongDescription}"/>

                <Label
                    Grid.Row="1" HorizontalOptions="Center" FontSize="18" Margin="0,-10,0,0"
                    Text="You will need to complete the sign in process in the web browser before using the application." 
                    IsVisible="{Binding ShowLongDescription}"/>

                <Button
                    Grid.Row="2"
                    Margin="20"
                    x:Name="SignInBtn"
                    HeightRequest="40" WidthRequest="120"
                    Command="{Binding SignInCommand}"
                    HorizontalOptions="Center"
                    SemanticProperties.Hint="Sign in"
                    Background="{StaticResource BrushSyncBlue}"
                    Text="Sign In"
                    IsVisible="{Binding ShowLogin}"/>

                <Button Grid.Row="2" x:Name="launchBrowser"
                        Margin="20"
                        HeightRequest="35" WidthRequest="200" Text="Launch browser again"
                        Command="{Binding DoLoginAgainCommand}" 
                        Background="LightGray" TextColor="Black"
                        HorizontalOptions="Center"
                        IsVisible="{Binding ShowLaunchBrowser}"/>

                <StackLayout Margin="20" Orientation="Horizontal" Grid.Row="2"
                             IsVisible="{Binding ShowLaunchingBrowser}" HorizontalOptions="Center" VerticalOptions="Center">
                    <ActivityIndicator  IsVisible="True" IsRunning="True" />
                    <Button 
                        BackgroundColor="Transparent"
                        FontSize="13"
                        HorizontalOptions="Center"
                        Text="Launching browser"
                        TextColor="Black"
                        VerticalOptions="Center"
                        Background="LightGray"
                        WidthRequest="200"
                        HeightRequest="35"
                        IsEnabled="False"/>
                </StackLayout>
          
            </Grid>
            
        </Border>

        <Image
            Grid.Row="1"
            Margin="0,0,0,80"
            HeightRequest="70"
            HorizontalOptions="Center"
            Source="tclogo.png"
            VerticalOptions="End"
            WidthRequest="120" />

        <controls:ToolBar
            Grid.Row="0"
            SignoutButtonVisibility="False"
            TabBarVisibility="False"/>
    </Grid>

</ContentPage>

